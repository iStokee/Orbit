<?xml version="1.0" encoding="utf-8" ?>
<Controls:MetroWindow
    x:Class="Orbit.Views.ScriptManagerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:converters="clr-namespace:Orbit.Converters"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:local="clr-namespace:Orbit"
    Title="Script Manager"
    Icon="{DynamicResource Orbit.IconImage}"
    Width="900"
    Height="650"
    TitleCharacterCasing="Normal"
    WindowStartupLocation="CenterOwner">

    <Controls:MetroWindow.IconTemplate>
        <DataTemplate>
            <iconPacks:PackIconMaterial
                Width="24"
                Height="24"
                Kind="CodeBraces" />
        </DataTemplate>
    </Controls:MetroWindow.IconTemplate>

    <Window.Resources>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <Border Grid.Row="0" CornerRadius="8,8,0,0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Offset="0" Color="{DynamicResource MahApps.Colors.Accent}" />
                    <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.Accent2}" />
                </LinearGradientBrush>
            </Border.Background>
            <Grid Margin="24,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <iconPacks:PackIconMaterial
                    Width="48"
                    Height="48"
                    Margin="0,0,16,0"
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                    Kind="CodeBraces" />

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock
                        FontSize="24"
                        FontWeight="Bold"
                        Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                        Text="Script Manager" />
                    <TextBlock
                        Margin="0,4,0,0"
                        FontSize="13"
                        Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                        Opacity="0.95"
                        Text="Manage and organize your script library • Instant hot-reload" />
                </StackPanel>
            </Grid>
        </Border>

        <!--  Main Content  -->
        <Border
            Grid.Row="1"
            Padding="20"
            Background="{DynamicResource MahApps.Brushes.ThemeBackground}"
            BorderBrush="{DynamicResource MahApps.Brushes.Gray6}"
            BorderThickness="1,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  Quick Actions  -->
                <StackPanel
                    Grid.Row="0"
                    Margin="0,0,0,20"
                    Orientation="Horizontal">
                    <Button
                        Width="140"
                        Height="36"
                        Margin="0,0,8,0"
                        Command="{Binding AddScriptCommand}"
                        Style="{StaticResource MahApps.Styles.Button.Square.Accent}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial
                                Width="16"
                                Height="16"
                                Margin="0,0,6,0"
                                Kind="FilePlus" />
                            <TextBlock VerticalAlignment="Center" Text="Add Script" />
                        </StackPanel>
                    </Button>

                    <Button
                        Width="140"
                        Height="36"
                        Margin="0,0,8,0"
                        Command="{Binding ClearMissingCommand}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial
                                Width="16"
                                Height="16"
                                Margin="0,0,6,0"
                                Kind="Broom" />
                            <TextBlock VerticalAlignment="Center" Text="Clear Missing" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!--  Favorites Section  -->
                <StackPanel
                    Grid.Row="1"
                    Margin="0,0,0,15"
                    Visibility="{Binding HasFavorites, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock
                        Margin="0,0,0,8"
                        FontSize="11"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource MahApps.Brushes.Gray2}"
                        Text="FAVORITES" />

                    <ItemsControl ItemsSource="{Binding Favorites}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,0,8,8"
                                    Padding="12,8"
                                    Background="{DynamicResource MahApps.Brushes.Accent}"
                                    CornerRadius="4"
                                    Cursor="Hand"
                                    ToolTip="{Binding FilePath}">
                                    <Border.InputBindings>
                                        <MouseBinding
                                            Command="{Binding DataContext.LoadScriptCommand, RelativeSource={RelativeSource AncestorType=Controls:MetroWindow}}"
                                            CommandParameter="{Binding}"
                                            MouseAction="LeftDoubleClick" />
                                    </Border.InputBindings>
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial
                                            Width="14"
                                            Height="14"
                                            Margin="0,0,6,0"
                                            Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                                            Kind="Star" />
                                        <TextBlock
                                            FontWeight="SemiBold"
                                            Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                                            Text="{Binding Name}" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!--  Recent Scripts  -->
                <DockPanel Grid.Row="2">
                    <TextBlock
                        Margin="0,0,0,8"
                        DockPanel.Dock="Top"
                        FontSize="11"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource MahApps.Brushes.Gray2}"
                        Text="RECENT SCRIPTS" />

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding RecentScripts}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="0,0,0,10"
                                        Padding="16"
                                        Background="{DynamicResource MahApps.Brushes.Gray9}"
                                        BorderBrush="{DynamicResource MahApps.Brushes.Gray6}"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Cursor="Hand">
                                        <Border.InputBindings>
                                            <MouseBinding
                                                Command="{Binding DataContext.LoadScriptCommand, RelativeSource={RelativeSource AncestorType=Controls:MetroWindow}}"
                                                CommandParameter="{Binding}"
                                                MouseAction="LeftDoubleClick" />
                                        </Border.InputBindings>

                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="BorderBrush" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                                        <Setter Property="BorderThickness" Value="2" />
                                                    </Trigger>
                                                    <DataTrigger Binding="{Binding FileExists}" Value="False">
                                                        <Setter Property="Opacity" Value="0.5" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <!--  Icon  -->
                                            <Border
                                                Grid.Column="0"
                                                Width="48"
                                                Height="48"
                                                Margin="0,0,16,0"
                                                Background="{DynamicResource MahApps.Brushes.Accent}"
                                                CornerRadius="24">
                                                <iconPacks:PackIconMaterial
                                                    Width="24"
                                                    Height="24"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                                                    Kind="FileCode" />
                                            </Border>

                                            <!--  Info  -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock
                                                        FontSize="15"
                                                        FontWeight="SemiBold"
                                                        Text="{Binding Name}" />
                                                    <Border
                                                        Margin="10,0,0,0"
                                                        Padding="6,2"
                                                        Background="#FF6B6B"
                                                        CornerRadius="3"
                                                        Visibility="{Binding FileExists, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                                                        <TextBlock
                                                            FontSize="10"
                                                            FontWeight="Bold"
                                                            Foreground="White"
                                                            Text="Missing" />
                                                    </Border>
                                                </StackPanel>

                                                <TextBlock
                                                    Margin="0,4,0,0"
                                                    FontSize="12"
                                                    Foreground="{DynamicResource MahApps.Brushes.Gray2}"
                                                    Text="{Binding FileName}" />

                                                <TextBlock
                                                    MaxWidth="500"
                                                    Margin="0,2,0,0"
                                                    FontSize="11"
                                                    Foreground="{DynamicResource MahApps.Brushes.Gray3}"
                                                    Text="{Binding Description}"
                                                    TextWrapping="Wrap"
                                                    Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}" />

                                                <TextBlock
                                                    Margin="0,4,0,0"
                                                    FontSize="10"
                                                    Foreground="{DynamicResource MahApps.Brushes.Gray4}"
                                                    Text="{Binding LastUsedDisplay, StringFormat='Last used: {0}'}" />
                                            </StackPanel>

                                            <!--  Actions  -->
                                            <StackPanel
                                                Grid.Column="2"
                                                VerticalAlignment="Center"
                                                Orientation="Horizontal">
                                                <Button
                                                    Width="36"
                                                    Height="36"
                                                    Margin="0,0,4,0"
                                                    Command="{Binding DataContext.ToggleFavoriteCommand, RelativeSource={RelativeSource AncestorType=Controls:MetroWindow}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource MahApps.Styles.Button.Circle}"
                                                    ToolTip="Toggle favorite">
                                                    <iconPacks:PackIconMaterial Width="18" Height="18">
                                                        <iconPacks:PackIconMaterial.Style>
                                                            <Style TargetType="iconPacks:PackIconMaterial">
                                                                <Setter Property="Kind" Value="StarOutline" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsFavorite}" Value="True">
                                                                        <Setter Property="Kind" Value="Star" />
                                                                        <Setter Property="Foreground" Value="#FFD700" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </iconPacks:PackIconMaterial.Style>
                                                    </iconPacks:PackIconMaterial>
                                                </Button>

                                                <Button
                                                    Width="36"
                                                    Height="36"
                                                    Command="{Binding DataContext.RemoveScriptCommand, RelativeSource={RelativeSource AncestorType=Controls:MetroWindow}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource MahApps.Styles.Button.Circle}"
                                                    ToolTip="Remove from list">
                                                    <iconPacks:PackIconMaterial
                                                        Width="18"
                                                        Height="18"
                                                        Foreground="#F44336"
                                                        Kind="Close" />
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </DockPanel>
            </Grid>
        </Border>

        <!--  Footer  -->
        <Border
            Grid.Row="2"
            Padding="15,12"
            Background="{DynamicResource MahApps.Brushes.Gray9}"
            BorderBrush="{DynamicResource MahApps.Brushes.Gray6}"
            BorderThickness="1"
            CornerRadius="0,0,8,8">
            <Grid>
                <TextBlock
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    FontSize="11"
                    Foreground="{DynamicResource MahApps.Brushes.Gray2}"
                    Text="Double-click a script to load (hot-reload enabled) • Star your favorites for quick access" />

                <Button
                    Width="100"
                    Height="32"
                    HorizontalAlignment="Right"
                    Click="CloseButton_Click"
                    Content="Close" />
            </Grid>
        </Border>
    </Grid>
</Controls:MetroWindow>
