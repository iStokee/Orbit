<UserControl x:Class="Orbit.Views.SessionsOverviewView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
             xmlns:converters="clr-namespace:Orbit.Converters"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}">

    <UserControl.Resources>
        <converters:SessionStateToColorConverter x:Key="SessionStateToColorConverter" />
        <converters:InjectionStateToColorConverter x:Key="InjectionStateToColorConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Style="{StaticResource Orbit.ToolHeader}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border Style="{StaticResource Orbit.ToolHeaderIcon}">
                    <iconPacks:PackIconMaterial
                        Margin="10,10,0,0"
                        Width="35"
                        Height="35"
                        Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                        Kind="ViewDashboard" />
                </Border>
                <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                    <TextBlock
                        FontSize="22"
                        FontWeight="Bold"
                        Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                        Text="Session Manager" />
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock
                            FontSize="12"
                            Foreground="{DynamicResource MahApps.Brushes.IdealForeground}"
                            Opacity="0.85"
                            Text="{Binding Sessions.Count, StringFormat='{}{0} Active Sessions'}" />
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Sessions list -->
        <Border Grid.Row="1" Style="{StaticResource Orbit.ToolCard}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Sessions}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,0,12" Padding="15"
                                Background="{DynamicResource MahApps.Brushes.ThemeBackground}"
                                BorderBrush="{DynamicResource MahApps.Brushes.Gray5}"
                                BorderThickness="1" CornerRadius="6" Cursor="Hand">
                            <Border.InputBindings>
                                <MouseBinding Command="{Binding DataContext.SetActiveCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                              CommandParameter="{Binding}"
                                              MouseAction="LeftClick" />
                            </Border.InputBindings>
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="BorderBrush" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                            <Setter Property="BorderThickness" Value="2" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <!-- Status indicator -->
                                <Border Grid.Column="0" Width="60" Height="60" Margin="0,0,15,0" VerticalAlignment="Center"
                                        Background="{Binding State, Converter={StaticResource SessionStateToColorConverter}}"
                                        CornerRadius="30">
                                    <Grid>
                                        <Ellipse Width="16" Height="16" VerticalAlignment="Center" HorizontalAlignment="Center"
                                                 Stroke="{DynamicResource MahApps.Brushes.Gray7}"
                                                 Fill="{DynamicResource MahApps.Brushes.IdealForeground}" />
                                    </Grid>
                                </Border>

                                <!-- Details -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock FontSize="16" FontWeight="SemiBold" Text="{Binding Name}"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                        <Border Padding="6,2" Background="{DynamicResource MahApps.Brushes.Gray8}" CornerRadius="3" Margin="0,0,6,0">
                                            <TextBlock FontSize="11" Foreground="{DynamicResource MahApps.Brushes.Gray2}"
                                                       Text="{Binding State}"/>
                                        </Border>
                                        <Border Padding="6,2" Background="{DynamicResource MahApps.Brushes.Accent}" CornerRadius="3" Margin="0,0,6,0">
                                            <TextBlock FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource MahApps.Brushes.AccentForeground}"
                                                       Text="{Binding InjectionState}"/>
                                        </Border>
                                        <TextBlock VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource MahApps.Brushes.Gray2}"
                                                   Text="{Binding CreatedAt, StringFormat='Created: {0:HH:mm:ss}'}"/>
                                    </StackPanel>
                                    <Border Padding="8,4" Background="{DynamicResource MahApps.Brushes.Gray9}" BorderBrush="{DynamicResource MahApps.Brushes.Accent3}" BorderThickness="1" CornerRadius="3"
                                            Visibility="{Binding LastError, Converter={StaticResource NullToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <iconPacks:PackIconMaterial Width="14" Height="14" Margin="0,0,6,0" VerticalAlignment="Center"
                                                                        Foreground="{DynamicResource MahApps.Brushes.Accent}" Kind="AlertCircle" />
                                            <TextBlock MaxWidth="500" FontSize="11" Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}" Text="{Binding LastError}" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>

                                <!-- Quick actions -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" Orientation="Horizontal">
                                    <Button Width="36" Height="36" Margin="0,0,6,0" Command="{Binding DataContext.FocusCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}"
                                            Style="{StaticResource MahApps.Styles.Button.Circle}" ToolTip="Focus Client Window">
                                        <iconPacks:PackIconMaterial Width="18" Height="18" Kind="Fullscreen" />
                                    </Button>
                                    <Button Width="36" Height="36" Command="{Binding DataContext.CloseCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}"
                                            Style="{StaticResource MahApps.Styles.Button.Circle}" ToolTip="Close Session">
                                        <iconPacks:PackIconMaterial Width="18" Height="18" Foreground="#F44336" Kind="Close" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
