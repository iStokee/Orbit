<?xml version="1.0" encoding="utf-8" ?>
<Controls:MetroWindow
    x:Class="Orbit.Views.AccountManagerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:viewModels="clr-namespace:Orbit.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Account Manager"
    Icon="/Orbital.jpg"
    Width="800"
    Height="600"
    MinWidth="600"
    MinHeight="400"
    TitleCharacterCasing="Normal"
    WindowStartupLocation="CenterOwner"
    d:DataContext="{d:DesignInstance viewModels:AccountManagerViewModel}">

    <Controls:MetroWindow.IconTemplate>
        <DataTemplate>
            <iconPacks:PackIconMaterial
                Width="24"
                Height="24"
                Kind="AccountMultiple"
                Foreground="{DynamicResource MahApps.Brushes.IdealForeground}" />
        </DataTemplate>
    </Controls:MetroWindow.IconTemplate>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
            <iconPacks:PackIconMaterial Kind="AccountMultiple" Width="24" Height="24" VerticalAlignment="Center" />
            <TextBlock
                Text="Manage Accounts"
                FontSize="18"
                FontWeight="SemiBold"
                Margin="8,0,0,0"
                VerticalAlignment="Center"
                Foreground="{DynamicResource MahApps.Brushes.IdealForeground}" />
        </StackPanel>

        <!--  Search Box  -->
        <TextBox
            Grid.Row="1"
            Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
            Controls:TextBoxHelper.Watermark="Search accounts..."
            Controls:TextBoxHelper.ClearTextButton="True"
            Margin="0,0,0,12">
            <TextBox.Style>
                <Style TargetType="TextBox" BasedOn="{StaticResource MahApps.Styles.TextBox}">
                    <Setter Property="Controls:TextBoxHelper.UseFloatingWatermark" Value="False" />
                </Style>
            </TextBox.Style>
        </TextBox>

        <!--  Account List  -->
        <DataGrid
            Grid.Row="2"
            ItemsSource="{Binding FilteredAccounts}"
            SelectedItem="{Binding SelectedAccount}"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            SelectionMode="Single"
            GridLinesVisibility="None"
            HeadersVisibility="Column"
            Margin="0,0,0,12">
            <DataGrid.Columns>
                <DataGridTextColumn
                    Header="Username"
                    Binding="{Binding Username}"
                    Width="*"
                    MinWidth="120"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    Header="Password"
                    Binding="{Binding PasswordMasked}"
                    Width="120"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    Header="World"
                    Binding="{Binding PreferredWorld}"
                    Width="80"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    Header="Last Used"
                    Binding="{Binding LastUsedDisplay}"
                    Width="140"
                    IsReadOnly="True" />
                <DataGridCheckBoxColumn
                    Header="Auto Login"
                    Binding="{Binding AutoLogin, UpdateSourceTrigger=PropertyChanged}"
                    Width="100" />
                <DataGridTemplateColumn Header="Actions" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button
                                Command="{Binding DataContext.DeleteAccountCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                CommandParameter="{Binding}"
                                Style="{StaticResource MahApps.Styles.Button.Circle}"
                                Width="32"
                                Height="32"
                                ToolTip="Delete Account">
                                <iconPacks:PackIconMaterial Kind="Delete" Width="16" Height="16" />
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!--  Add Account Form  -->
        <Border
            Grid.Row="3"
            BorderBrush="{DynamicResource MahApps.Brushes.Accent}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="120" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBox
                    Grid.Column="0"
                    Text="{Binding NewUsername, UpdateSourceTrigger=PropertyChanged}"
                    Controls:TextBoxHelper.Watermark="Username"
                    Margin="0,0,8,0" />

                <PasswordBox
                    Grid.Column="1"
                    Controls:TextBoxHelper.Watermark="Password (min 5 chars)"
                    Controls:PasswordBoxHelper.CapsLockWarningToolTip="Caps Lock is ON"
                    Margin="0,0,8,0"
                    x:Name="NewPasswordBox"
                    PasswordChanged="NewPasswordBox_PasswordChanged" />

                <Controls:NumericUpDown
                    Grid.Column="2"
                    Value="{Binding NewPreferredWorld}"
                    Minimum="1"
                    Maximum="200"
                    Margin="0,0,8,0" />

                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <Button
                        Command="{Binding AddAccountCommand}"
                        Style="{StaticResource MahApps.Styles.Button.Circle}"
                        Width="36"
                        Height="36"
                        Margin="0,0,4,0"
                        ToolTip="Add Account">
                        <iconPacks:PackIconMaterial Kind="Plus" />
                    </Button>
                    <Button
                        Command="{Binding ClearFormCommand}"
                        Style="{StaticResource MahApps.Styles.Button.Circle}"
                        Width="36"
                        Height="36"
                        ToolTip="Clear Form">
                        <iconPacks:PackIconMaterial Kind="Close" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Controls:MetroWindow>
