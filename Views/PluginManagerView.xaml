<UserControl x:Class="Orbit.Views.PluginManagerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Background="{DynamicResource MahApps.Brushes.ThemeBackground}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header and Toolbar -->
        <Border Grid.Row="0"
                Background="{DynamicResource MahApps.Brushes.Accent}"
                Padding="16,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <iconPacks:PackIconMaterial Kind="Puzzle"
                                               Width="24"
                                               Height="24"
                                               VerticalAlignment="Center"
                                               Foreground="White"
                                               Margin="0,0,12,0"/>
                    <TextBlock Text="Plugin Manager"
                              FontSize="18"
                              FontWeight="SemiBold"
                              Foreground="White"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Row="1"
                           Orientation="Horizontal"
                           Margin="0,12,0,0">
                    <Button Content="Load Plugin"
                           Command="{Binding LoadPluginCommand}"
                           Style="{DynamicResource MahApps.Styles.Button.Flat}"
                           Margin="0,0,8,0"
                           Padding="12,6">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <iconPacks:PackIconMaterial Kind="FolderOpen"
                                                               Width="16"
                                                               Height="16"
                                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <Button Content="Auto-Load All"
                           Command="{Binding AutoLoadAllCommand}"
                           Style="{DynamicResource MahApps.Styles.Button.Flat}"
                           Margin="0,0,8,0"
                           Padding="12,6">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <iconPacks:PackIconMaterial Kind="PlaylistPlay"
                                                               Width="16"
                                                               Height="16"
                                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <Button Content="Refresh"
                           Command="{Binding RefreshCommand}"
                           Style="{DynamicResource MahApps.Styles.Button.Flat}"
                           Padding="12,6">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <iconPacks:PackIconMaterial Kind="Refresh"
                                                               Width="16"
                                                               Height="16"
                                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Plugin List -->
        <ScrollViewer Grid.Row="1"
                     VerticalScrollBarVisibility="Auto"
                     Padding="16">
            <ItemsControl ItemsSource="{Binding Plugins}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource MahApps.Brushes.Gray10}"
                               BorderBrush="{DynamicResource MahApps.Brushes.Accent4}"
                               BorderThickness="1"
                               CornerRadius="4"
                               Margin="0,0,0,12"
                               Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Plugin Name and Version -->
                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="{Binding DisplayName}"
                                              FontSize="16"
                                              FontWeight="SemiBold"
                                              Foreground="{DynamicResource MahApps.Brushes.Text}"/>
                                    <TextBlock Margin="0,4,0,0">
                                        <Run Text="v"
                                             Foreground="{DynamicResource MahApps.Brushes.Gray}"/>
                                        <Run Text="{Binding Version}"
                                             Foreground="{DynamicResource MahApps.Brushes.Gray}"/>
                                        <Run Text=" by "
                                             Foreground="{DynamicResource MahApps.Brushes.Gray}"/>
                                        <Run Text="{Binding Author}"
                                             Foreground="{DynamicResource MahApps.Brushes.Accent}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Action Buttons -->
                                <StackPanel Grid.Row="0"
                                           Grid.Column="1"
                                           Orientation="Horizontal"
                                           VerticalAlignment="Top">
                                    <Button Content="Hot Reload"
                                           Command="{Binding ReloadCommand}"
                                           Style="{DynamicResource MahApps.Styles.Button.Square.Accent}"
                                           Margin="0,0,8,0"
                                           Padding="8,4"
                                           FontSize="12">
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <iconPacks:PackIconMaterial Kind="Reload"
                                                                               Width="14"
                                                                               Height="14"
                                                                               Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>

                                    <Button Content="Unload"
                                           Command="{Binding UnloadCommand}"
                                           Style="{DynamicResource MahApps.Styles.Button.Square}"
                                           Padding="8,4"
                                           FontSize="12">
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <iconPacks:PackIconMaterial Kind="Close"
                                                                               Width="14"
                                                                               Height="14"
                                                                               Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>
                                </StackPanel>

                                <!-- Description -->
                                <TextBlock Grid.Row="1"
                                          Grid.Column="0"
                                          Grid.ColumnSpan="2"
                                          Text="{Binding Description}"
                                          TextWrapping="Wrap"
                                          Margin="0,8,0,0"
                                          Foreground="{DynamicResource MahApps.Brushes.Gray}"/>

                                <!-- Metadata -->
                                <StackPanel Grid.Row="2"
                                           Grid.Column="0"
                                           Grid.ColumnSpan="2"
                                           Margin="0,8,0,0">
                                    <TextBlock FontSize="11"
                                              Foreground="{DynamicResource MahApps.Brushes.Gray}">
                                        <Run Text="Key:"/>
                                        <Run Text="{Binding Key}"
                                             FontFamily="Consolas"/>
                                    </TextBlock>
                                    <TextBlock FontSize="11"
                                              Foreground="{DynamicResource MahApps.Brushes.Gray}"
                                              Margin="0,2,0,0">
                                        <Run Text="Loaded:"/>
                                        <Run Text="{Binding LoadedAt}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Path (Expandable) -->
                                <Expander Grid.Row="3"
                                         Grid.Column="0"
                                         Grid.ColumnSpan="2"
                                         Header="File Path"
                                         Margin="0,8,0,0"
                                         IsExpanded="False">
                                    <TextBlock Text="{Binding PluginPath}"
                                              TextWrapping="Wrap"
                                              FontFamily="Consolas"
                                              FontSize="11"
                                              Foreground="{DynamicResource MahApps.Brushes.Gray}"
                                              Margin="0,4,0,0"/>
                                </Expander>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{DynamicResource MahApps.Brushes.Gray10}"
                BorderBrush="{DynamicResource MahApps.Brushes.Gray5}"
                BorderThickness="0,1,0,0"
                Padding="16,8">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}"
                          VerticalAlignment="Center"
                          Foreground="{DynamicResource MahApps.Brushes.Text}"/>

                <mah:ProgressRing IsActive="{Binding IsLoading}"
                                 Width="20"
                                 Height="20"
                                 HorizontalAlignment="Right"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
